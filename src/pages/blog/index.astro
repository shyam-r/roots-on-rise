---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import { Button, Section } from '@/components/ui';
import { generateBreadcrumbSchema } from '@/data/products';

const posts = (await getCollection('blog')).sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);

const breadcrumbSchema = generateBreadcrumbSchema('Blog', '/blog');

const categoryLabels: Record<string, string> = {
  deity: 'Deities',
  festival: 'Festivals',
  culture: 'Culture',
  activity: 'Activities',
};
---

<Layout
  title="Blog - Hindu Mythology & Culture for Kids | Roots On Rise"
  description="Explore Hindu mythology, deities, festivals, and cultural traditions through kid-friendly stories and activities. Perfect for ages 2-8."
>
  <script slot="structured-data" type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />

  <!-- Hero -->
  <Section background="tertiary" container="md">
    <div class="text-center">
      <h1 class="font-title font-bold text-4xl md:text-5xl text-dark mb-6">
        stories & <span class="text-primary">learning</span>
      </h1>
      <p class="text-dark/70 text-lg max-w-2xl mx-auto">
        Kid-friendly stories about Hindu gods, goddesses, festivals, and traditions.
        Read together as a family and spark curiosity about heritage.
      </p>
    </div>
  </Section>

  <!-- Blog Grid -->
  <Section>
    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3 max-w-5xl mx-auto">
      {posts.map((post) => (
        <a href={`/blog/${post.id.replace(/\.md$/, '')}`} class="group bg-white rounded-2xl border border-dark/5 overflow-hidden hover:shadow-md transition-shadow">
          {post.data.image && (
            <div class="aspect-[3/2] overflow-hidden bg-tertiary">
              <img
                src={post.data.image}
                alt={post.data.imageAlt || post.data.title}
                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                loading="lazy"
              />
            </div>
          )}
          <div class="p-5">
            <div class="flex items-center gap-2 mb-2">
              <span class="text-xs font-medium text-primary/70 uppercase tracking-wider">
                {categoryLabels[post.data.category] || post.data.category}
              </span>
              <span class="text-dark/30 text-xs">
                {post.data.ageRange}
              </span>
            </div>
            <h2 class="font-title font-bold text-lg text-dark group-hover:text-primary transition-colors mb-2">
              {post.data.title}
            </h2>
            <p class="text-dark/60 text-sm line-clamp-2">
              {post.data.description}
            </p>
          </div>
        </a>
      ))}
    </div>
  </Section>

  <!-- CTA -->
  <Section background="dark" container="md">
    <div class="text-center">
      <h2 class="font-title font-bold text-2xl md:text-3xl text-light mb-4">
        bring these stories <span class="text-primary">home</span>
      </h2>
      <p class="text-light/70 max-w-xl mx-auto mb-8">
        Our beautifully illustrated books bring Hindu mythology to life for young readers.
      </p>
      <Button variant="amazon" size="lg" asChild>
        <a href="https://www.amazon.com/dp/8195870724?tag=rootsonrise-20" target="_blank" rel="noopener">
          Shop Books on Amazon
        </a>
      </Button>
    </div>
  </Section>
</Layout>
