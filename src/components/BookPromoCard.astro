---
/**
 * BookPromoCard â€” Compact inline card with book image + format pills
 *
 * Drop anywhere: blog posts, downloads page, landing pages.
 * Each format pill links directly to Amazon.
 *
 * @example <BookPromoCard seriesId="marvelous-hindu-deities" />
 * @example <BookPromoCard seriesId="shloka-mantra" label="Learn Mantras" />
 */
import { BOOK_SERIES, getBooksBySeriesId, getAmazonUrl } from '@/data/products';
import { getOptimizedImage } from '@/lib/images';

interface Props {
  seriesId: string;
  label?: string;
  className?: string;
}

const { seriesId, label = 'Featured Book', className = '' } = Astro.props;
const series = BOOK_SERIES.find(s => s.id === seriesId);
const books = series ? getBooksBySeriesId(series.id) : [];
const primaryBook = books[0];
const thumbImage = primaryBook ? getOptimizedImage(primaryBook.image, 'thumb') : '';
---

{series && primaryBook && (
  <div class:list={[
    "not-prose rounded-2xl bg-gradient-to-r from-amber-50 to-orange-50",
    "border border-amber-200/50 p-4 md:p-5",
    className
  ]}>
    <div class="flex items-start gap-4">
      <a
        href={getAmazonUrl(series.formats[0]?.asin || '')}
        target="_blank"
        rel="noopener noreferrer"
        class="w-20 h-28 md:w-24 md:h-32 shrink-0 rounded-lg overflow-hidden shadow-md bg-white"
      >
        <img
          src={thumbImage}
          alt={series.name}
          class="w-full h-full object-cover"
          loading="lazy"
          decoding="async"
        />
      </a>
      <div class="flex-1 min-w-0">
        <p class="text-xs font-semibold text-primary uppercase tracking-wider mb-1">{label}</p>
        <p class="font-title font-bold text-dark text-sm md:text-base mb-1">{series.name}</p>
        <div class="flex items-center gap-2 mb-3">
          <span class="text-amber-500 text-xs">&#9733;&#9733;&#9733;&#9733;&#9733;</span>
          <span class="text-dark/40 text-xs">Loved by families</span>
        </div>
        <div class="flex flex-wrap gap-2">
          {series.formats.map((fmt) => (
            <a
              href={getAmazonUrl(fmt.asin || '')}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center px-3 py-1.5 bg-[#FF9900] hover:bg-[#e68a00] text-white text-xs font-semibold rounded-full transition-colors shadow-sm"
            >
              {fmt.name} &mdash; {fmt.price}
            </a>
          ))}
        </div>
      </div>
    </div>
  </div>
)}
